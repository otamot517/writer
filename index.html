<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jekyll 文章撰寫介面 - 即時預覽版</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入解析 Markdown 的函式庫 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        
        body { font-family: 'Inter', sans-serif; }
        
        /* 預覽區域的 Markdown 樣式（類 GitHub 效果） */
        .prose h1 { border-bottom: 1px solid #eaecef; padding-bottom: .3em; font-size: 2em; font-weight: 600; margin-top: 24px; margin-bottom: 16px; }
        .prose h2 { border-bottom: 1px solid #eaecef; padding-bottom: .3em; font-size: 1.5em; font-weight: 600; margin-top: 24px; margin-bottom: 16px; }
        .prose h3 { font-size: 1.25em; font-weight: 600; margin-top: 24px; margin-bottom: 16px; }
        .prose p { margin-top: 0; margin-bottom: 16px; line-height: 1.6; }
        .prose ul, .prose ol { padding-left: 2em; margin-bottom: 16px; }
        .prose ul { list-style-type: disc; }
        .prose ol { list-style-type: decimal; }
        .prose code { background-color: rgba(27,31,35,.05); border-radius: 3px; font-size: 85%; margin: 0; padding: .2em .4em; font-family: monospace; }
        .prose pre { background-color: #f6f8fa; border-radius: 3px; line-height: 1.45; overflow: auto; padding: 16px; margin-bottom: 16px; }
        .prose blockquote { border-left: .25em solid #dfe2e5; color: #6a737d; padding: 0 1em; margin-bottom: 16px; }
        .prose img { max-width: 100%; box-sizing: content-box; background-color: #fff; }

        /* 隱藏滾動條但保持功能（選用） */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #9ca3af; }
    </style>
</head>
<body class="bg-slate-50 h-screen flex flex-col overflow-hidden">

    <!-- 頂部導覽列 -->
    <header class="bg-white border-b border-slate-200 px-6 py-3 flex justify-between items-center shrink-0">
        <div class="flex items-center space-x-3">
            <div class="bg-blue-600 p-2 rounded-lg">
                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
            </div>
            <h1 class="text-xl font-bold text-slate-800">Jekyll Writer <span class="text-sm font-normal text-slate-400 ml-2">v2.0</span></h1>
        </div>
        <div class="flex items-center space-x-4">
            <button onclick="generateAndDownloadPost()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition flex items-center shadow-sm">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                下載 Markdown
            </button>
        </div>
    </header>

    <!-- 主要內容區：拆分為資訊與編輯 -->
    <main class="flex flex-1 overflow-hidden">
        
        <!-- 左側面板：編輯與設定 -->
        <div class="w-1/2 flex flex-col border-r border-slate-200 bg-white">
            <!-- 資訊填寫區 -->
            <div class="p-4 border-b border-slate-100 space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-semibold text-slate-500 uppercase tracking-wider mb-1">文章標題 (Title)</label>
                        <input type="text" id="postTitle" placeholder="我的新文章..." class="w-full px-3 py-2 border border-slate-200 rounded-md focus:ring-2 focus:ring-blue-500 outline-none transition">
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-slate-500 uppercase tracking-wider mb-1">發布日期 (Date)</label>
                        <input type="datetime-local" id="publishDate" class="w-full px-3 py-2 border border-slate-200 rounded-md focus:ring-2 focus:ring-blue-500 outline-none transition">
                    </div>
                </div>
            </div>

            <!-- 編輯器 -->
            <div class="flex-1 relative">
                <label class="absolute top-2 left-4 text-[10px] font-bold text-slate-300 uppercase z-10">Markdown Editor</label>
                <textarea id="postContent" 
                    class="w-full h-full p-6 pt-10 outline-none resize-none font-mono text-sm leading-relaxed text-slate-700 custom-scrollbar" 
                    placeholder="# 開始撰寫文章內容..."
                    oninput="updatePreview()"></textarea>
            </div>
        </div>

        <!-- 右側面板：即時預覽 -->
        <div class="w-1/2 bg-white flex flex-col">
            <div class="p-4 border-b border-slate-100 flex items-center">
                <span class="text-xs font-semibold text-slate-500 uppercase tracking-wider">即時預覽 (Live Preview)</span>
            </div>
            <div id="previewArea" class="flex-1 overflow-y-auto p-8 custom-scrollbar bg-white">
                <div id="previewContent" class="prose max-w-none text-slate-800">
                    <!-- Markdown 渲染結果會顯示在這裡 -->
                </div>
            </div>
        </div>
    </main>

    <!-- 訊息提示 -->
    <div id="toast" class="fixed bottom-6 left-1/2 -translate-x-1/2 px-6 py-3 bg-slate-800 text-white rounded-full text-sm shadow-xl opacity-0 transition-opacity pointer-events-none duration-300 z-50"></div>

    <script>
        const TIMEZONE_OFFSET = "+0800";
        const postTitle = document.getElementById('postTitle');
        const publishDate = document.getElementById('publishDate');
        const postContent = document.getElementById('postContent');
        const previewContent = document.getElementById('previewContent');
        const toast = document.getElementById('toast');

        // 初始化日期
        window.onload = function() {
            const now = new Date();
            const offset = now.getTimezoneOffset() * 60000;
            const localISOTime = (new Date(now - offset)).toISOString().slice(0, 16);
            publishDate.value = localISOTime;
            updatePreview();
        }

        // 即時預覽功能
        function updatePreview() {
            const content = postContent.value;
            // 如果內容為空，顯示提示訊息
            if (!content.trim()) {
                previewContent.innerHTML = '<p class="text-slate-300 italic">預覽內容將顯示在此...</p>';
                return;
            }
            // 使用 marked 渲染 Markdown
            previewContent.innerHTML = marked.parse(content);
        }

        // 顯示通知
        function showToast(msg) {
            toast.textContent = msg;
            toast.classList.remove('opacity-0');
            setTimeout(() => toast.classList.add('opacity-0'), 3000);
        }

        // Slugify 邏輯
        function slugify(title) {
            return title.toLowerCase().trim()
                .replace(/[^\w\s-]/g, '')
                .replace(/[\s_-]+/g, '-')
                .replace(/^-+|-+$/g, '');
        }

        // 格式化日期
        function formatJekyllDate(dateObj) {
            const pad = (n) => n.toString().padStart(2, '0');
            return `${dateObj.getFullYear()}-${pad(dateObj.getMonth()+1)}-${pad(dateObj.getDate())} ${pad(dateObj.getHours())}:${pad(dateObj.getMinutes())}:00 ${TIMEZONE_OFFSET}`;
        }

        // 下載檔案
        function generateAndDownloadPost() {
            const titleVal = postTitle.value.trim();
            const dateVal = publishDate.value;
            const contentVal = postContent.value;

            if (!titleVal) { showToast('請填寫標題'); return; }

            const dateObj = new Date(dateVal);
            const jekyllDate = formatJekyllDate(dateObj);
            const dateStr = jekyllDate.substring(0, 10);
            const slug = slugify(titleVal) || 'new-post';

            const fileContent = `---
layout: post
title: "${titleVal.replace(/"/g, '\\"')}"
date: ${jekyllDate}
---

${contentVal}`;

            const filename = `${dateStr}-${slug}.md`;
            const blob = new Blob([fileContent], { type: 'text/markdown;charset=utf-8' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);

            showToast(`已下載：${filename}`);
        }
    </script>
</body>
</html>